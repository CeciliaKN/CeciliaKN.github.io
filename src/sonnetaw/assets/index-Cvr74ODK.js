(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=t(r);fetch(r.href,l)}})();class R{constructor(){this.dict={},this.currentLanguage="en",this.customDict={}}async loadDictionary(e,t="en"){this.dict=e,this.currentLanguage=t,this.loadCustomDictionary()}loadCustomDictionary(){try{const e=localStorage.getItem(`customDict_${this.currentLanguage}`);e&&(this.customDict=JSON.parse(e),console.log(`Loaded ${Object.keys(this.customDict).length} custom words`))}catch(e){console.error("Failed to load custom dictionary:",e),this.customDict={}}}saveCustomDictionary(){try{localStorage.setItem(`customDict_${this.currentLanguage}`,JSON.stringify(this.customDict))}catch(e){console.error("Failed to save custom dictionary:",e)}}addCustomWord(e,t){const o=e.toLowerCase().replace(/[^a-z']/g,"");this.customDict[o]=[t],this.saveCustomDictionary()}getCurrentLanguage(){return this.currentLanguage}lookup(e){const t=e.toLowerCase().replace(/[^a-z']/g,"");if(this.customDict[t]?.length>0)return this.customDict[t][0];const o=this.dict[t];return!o||o.length===0?null:o[0]}extractSyllables(e){const t=[];let o=[],r=0;for(const l of e){o.push(l);const a=l.match(/[012]$/);a&&(r=parseInt(a[0]),t.push({phonemes:o,stress:r}),o=[],r=0)}return o.length>0&&t.length>0&&t[t.length-1].phonemes.push(...o),t}extractRhymeKey(e){let t=-1;for(let o=e.length-1;o>=0;o--)if(e[o].match(/[012]$/)){t=o;break}return t===-1?"":e.slice(t).map(o=>o.replace(/[012]$/,"")).join("-")}estimateSyllables(e){const t=e.toLowerCase();let o=0,r=!1;for(let l=0;l<t.length;l++){const a=t[l];"aeiouy".includes(a)?r||(o++,r=!0):r=!1}return t.endsWith("e")&&o>1&&o--,t.match(/^(fire|hour|our)$/)&&(o=1),Math.max(1,o)}createFallbackAnalysis(e){const t=this.estimateSyllables(e),o=[];for(let l=0;l<t;l++){const a=t===1||l===0?1:0;o.push({phonemes:[],stress:a})}const r=e.length>=2?e.slice(-2).toLowerCase():e.toLowerCase();return{word:e.toLowerCase(),originalWord:e,syllables:o,rhymeKey:r,found:!1}}syllabifyWord(e,t){const o=e.toLowerCase(),r="aeiouy",l=[],a=[];for(let s=0;s<o.length;s++)r.includes(o[s])&&a.push(s);if(a.length===0||t.length===0)return[[0,e.length-1]];if(t.length!==a.length){const s=e.length/t.length;for(let i=0;i<t.length;i++){const c=Math.floor(i*s),d=i===t.length-1?e.length-1:Math.floor((i+1)*s)-1;l.push([c,d])}return l}for(let s=0;s<a.length;s++){const i=a[s];let c,d;if(s===0)c=0;else{const m=a[s-1],h=i-m-1;if(h===0)c=i;else if(h===1)c=m+1;else if(h===2)c=m+2;else if(h===3)c=m+3;else{const u=Math.floor(h/2);c=m+1+u}}if(s===a.length-1)d=e.length-1;else{const h=a[s+1]-i-1;if(h===0)d=i;else if(h===1)d=i;else if(h===2)d=i+1;else if(h===3)d=i+2;else{const u=Math.floor(h/2);d=i+u}}l.push([c,d])}return l}analyzeWord(e){const t=this.lookup(e);if(!t)return this.createFallbackAnalysis(e);const o=this.extractSyllables(t),r=this.extractRhymeKey(t);return{word:e.toLowerCase(),originalWord:e,syllables:o,rhymeKey:r,found:!0}}}function T(n){return n.trim().split(/\s+/).filter(e=>e.length>0)}function V(n){return n.replace(/['']/g,"'").replace(/[^a-zA-Z']/g,"")}class W{constructor(e){this.dictionary=e}analyzeLine(e,t){const o=T(e),r=[],l=[];for(const i of o){const c=V(i);if(!c)continue;const d=this.dictionary.analyzeWord(c);r.push(d);for(const m of d.syllables)l.push(m.stress)}let s=(r.length>0?r[r.length-1]:null)?.rhymeKey||"";if(s===""&&r.length>0){for(let i=r.length-1;i>=0;i--)if(r[i].rhymeKey){s=r[i].rhymeKey;break}}return{lineNumber:t,text:e,words:r,stressPattern:l,rhymeKey:s}}checkMeter(e,t,o="iambic"){return Math.abs(e.length-t.length)>2||e.length!==t.length?!1:o==="iambic"?this.checkIambicMeter(e,t):this.checkStrictMeter(e,t)}checkIambicMeter(e,t){for(let o=0;o<t.length;o++)if(t[o]===1){if(e[o]===0)return!1}else if(e[o]===1)continue;return!0}checkStrictMeter(e,t){for(let o=0;o<t.length;o++)if(t[o]===1&&e[o]!==1||t[o]===0&&e[o]===1)return!1;return!0}validateRhymeScheme(e,t){const o={},r={},l=[];for(let a=0;a<Math.min(e.length,t.length);a++){const s=t[a],i=e[a].rhymeKey;o[s]||(o[s]=[],r[s]=[]),o[s].push(a),r[s].push(i)}for(const[a,s]of Object.entries(o)){if(s.length<=1)continue;const i=r[a],c=i.filter(m=>m!==""),d=new Set(c);d.size>1&&l.push(`Rhyme group ${a} has inconsistent rhymes: ${Array.from(d).join(", ")}`),c.length<i.length&&l.push(`Rhyme group ${a} contains words not found in dictionary`)}return{valid:l.length===0,issues:l,rhymeGroups:o}}analyzeSonnet(e,t){const r=e.split(`
`).filter(s=>s.trim().length>0).map((s,i)=>{const c=this.analyzeLine(s,i+1);return c.expectedStressPattern=t.meter.stressPattern,c.meterValid=this.checkMeter(c.stressPattern,t.meter.stressPattern,t.meter.type||"iambic"),c}),l=this.validateRhymeScheme(r,t.rhymeScheme),a=[];for(const s of r)s.words.length===0||Math.abs(s.stressPattern.length-t.meter.stressPattern.length)>2||s.meterValid||a.push(`Line ${s.lineNumber}: Expected ${t.meter.stressPattern.length} syllables with pattern ${t.meter.stressPattern.join("")}, got ${s.stressPattern.length} syllables with pattern ${s.stressPattern.join("")}`);return{lines:r,form:t,rhymeSchemeValid:l.valid,meterValid:a.length===0,rhymeIssues:l.issues,meterIssues:a,rhymeGroups:l.rhymeGroups}}}const G={devRepo:{owner:"ShioLilia",name:"sonnetaw",branch:"main"}},v={name:"Iambic Pentameter",description:"Unstressed-stressed pattern, 10 syllables per line",stressPattern:[0,1,0,1,0,1,0,1,0,1],syllableCount:10,type:"iambic"},H=[{id:"shakespearean",name:"Shakespearean Sonnet",description:"ABAB CDCD EFEF GG",rhymeScheme:["A","B","A","B","C","D","C","D","E","F","E","F","G","G"],meter:v,lineCount:14},{id:"petrarchan1",name:"Petrarchan Sonnet (CDECDE)",description:"ABBAABBA CDECDE",rhymeScheme:["A","B","B","A","A","B","B","A","C","D","E","C","D","E"],meter:v,lineCount:14},{id:"petrarchan2",name:"Petrarchan Sonnet (CDCDCD)",description:"ABBAABBA CDCDCD",rhymeScheme:["A","B","B","A","A","B","B","A","C","D","C","D","C","D"],meter:v,lineCount:14}],b=[{code:"en",name:"English",dictionaryFile:"eng-cmu.json",poeticForms:H}];function K(n,e){return`https://raw.githubusercontent.com/${n.owner}/${n.name}/${n.branch}/${e}`}function B(n){const e=b.find(t=>t.code===n);if(!e)throw new Error(`Unsupported language: ${n}`);return K(G.devRepo,`public/data/${e.dictionaryFile}`)}B("en");const D=new R,O=new W(D);let w=!1,C="en",p=null;const A="__TAURI__"in window;async function I(n="en"){try{let e;if(w=!1,A){console.log(`Loading dictionary from local file (Tauri mode) - Language: ${n}...`);const t=b.find(r=>r.code===n);if(!t)throw new Error(`Unsupported language: ${n}`);const o=await fetch(`/data/${t.dictionaryFile}`);if(!o.ok)throw new Error(`Failed to load local dictionary: ${o.statusText}`);e=await o.json(),console.log(`Dictionary loaded successfully from local file - ${t.name}`)}else{console.log(`Loading dictionary from GitHub (web mode) - Language: ${n}...`);const t=B(n),o=await fetch(t);if(!o.ok)throw new Error(`Failed to load dictionary: ${o.statusText}`);e=await o.json(),console.log("Dictionary loaded successfully from GitHub repository")}await D.loadDictionary(e,n),C=n,w=!0}catch(e){console.error("Error loading dictionary:",e),alert(A?"Failed to load pronunciation dictionary from local files.":"Failed to load pronunciation dictionary. Please check your internet connection.")}}I();const E=document.getElementById("languageSelect"),M=document.getElementById("poemInput"),g=document.getElementById("sonnetForm"),j=document.getElementById("analyzeBtn"),f=document.getElementById("output");function U(){E.innerHTML="";for(const n of b){const e=document.createElement("option");e.value=n.code,e.textContent=n.name,n.code===C&&(e.selected=!0),E.appendChild(e)}}function F(){g.innerHTML="";const n=b.find(e=>e.code===C);if(!n||n.poeticForms.length===0){const e=document.createElement("option");e.textContent="No forms available",e.disabled=!0,g.appendChild(e),p=null;return}for(const e of n.poeticForms){const t=document.createElement("option");t.value=e.id,t.textContent=e.name,t.title=e.description,g.appendChild(t)}n.poeticForms.length>0&&(p=n.poeticForms[0])}E.addEventListener("change",async()=>{const n=E.value;n!==C&&(console.log(`Switching language to: ${n}`),f.innerHTML='<p style="color: #999; font-style: italic;">Loading dictionary...</p>',await I(n),w&&(F(),f.innerHTML='<p style="color: #999; font-style: italic;">Dictionary loaded. Ready to analyze.</p>'))});g.addEventListener("change",()=>{const n=g.value,e=b.find(t=>t.code===C);e&&(p=e.poeticForms.find(t=>t.id===n)||null)});U();F();function _(n){return{A:"#8B4513",B:"#4682B4",C:"#6B8E23",D:"#B8860B",E:"#8B008B",F:"#CD5C5C",G:"#2F4F4F",H:"#556B2F"}[n]||"#666"}function q(n){const e=new Set;for(const[t,o]of Object.entries(n.rhymeGroups)){if(o.length<=1)continue;const r=o.map(s=>n.lines[s].rhymeKey),l=r.filter(s=>s!=="");if(new Set(l).size>1){const s=new Map;o.forEach((d,m)=>{const h=r[m];s.has(h)||s.set(h,[]),s.get(h).push(d)});let i=1/0,c=[];for(const[d,m]of s.entries())m.length<i&&(i=m.length,c=m);c.forEach(d=>e.add(d))}}return e}function J(n,e,t,o){const r=document.createElement("div");r.className="line";const l=n.words.length>0&&Math.abs(n.stressPattern.length-(n.expectedStressPattern?.length||10))<=2;l&&!n.meterValid&&r.classList.add("meter-invalid");const a=document.createElement("span");a.className="line-number",a.textContent=`${n.lineNumber}.`,r.appendChild(a);for(const i of n.words){const c=document.createElement("span");if(c.className="word",i.found&&i.syllables.length>0){const d=D.syllabifyWord(i.originalWord,i.syllables),m=i.originalWord;let h=0;if(l&&!n.meterValid&&n.expectedStressPattern)for(const u of n.words){if(u===i)break;h+=u.syllables.length}for(let u=0;u<i.syllables.length;u++){const S=i.syllables[u],[P,x]=d[u]||[0,m.length-1],N=m.substring(P,x+1);let L="stress-0";S.stress===1?L="stress-1":S.stress===2&&(L="stress-2");const y=document.createElement("span");if(y.className=`syllable ${L}`,y.textContent=N,l&&!n.meterValid&&n.expectedStressPattern){const $=h+u;if($<n.expectedStressPattern.length){const k=n.expectedStressPattern[$],z=S.stress;k===1&&z!==1&&y.classList.add("meter-error")}}y.title=`Syllable ${u+1}/${i.syllables.length}, Stress: ${S.stress}`,c.appendChild(y)}c.title=`Syllables: ${i.syllables.length}, Stress pattern: ${i.syllables.map(u=>u.stress).join("")}`}else{const d=document.createElement("span");d.className="word-not-found",d.textContent=i.originalWord,d.title="Word not found in dictionary",c.appendChild(d)}r.appendChild(c),r.appendChild(document.createTextNode(" "))}const s=document.createElement("span");return s.className="rhyme-marker",s.textContent=e,s.style.color=_(e),o.has(n.lineNumber-1)&&s.classList.add("rhyme-error"),r.appendChild(s),r.title=n.text,r}function Z(n){f.innerHTML="";const e=new Set;for(const c of n.lines)for(const d of c.words)d.found||e.add(d.originalWord);if(e.size>0){const c=document.createElement("div");c.className="warning-box",c.innerHTML=`
      <strong>⚠️ Words not in dictionary:</strong> 
      ${Array.from(e).join(", ")}
      <br><small>Analysis may be less accurate. Syllable counts and rhymes are estimated.</small>
    `,f.appendChild(c)}const t=q(n),o=document.createElement("div");n.lines.forEach((c,d)=>{const m=n.form.rhymeScheme[d]||"?",h=J(c,m,n,t);o.appendChild(h)}),f.appendChild(o);const r=document.createElement("div");r.className="summary";const l=document.createElement("h3");l.textContent="Analysis Summary",r.appendChild(l);const a=document.createElement("div");a.className="summary-item",a.innerHTML=`<strong>Form:</strong> ${n.form.name}<br>
                        <strong>Expected Meter:</strong> ${n.form.meter.name} (${n.form.meter.description})<br>
                        <strong>Expected Rhyme Scheme:</strong> ${n.form.rhymeScheme.join("")}`,r.appendChild(a);const s=document.createElement("div");s.className=`summary-item ${n.meterValid?"valid":"invalid"}`,s.innerHTML=`<strong>Meter:</strong> ${n.meterValid?"✓ Valid":"✗ Issues Found"}`,!n.meterValid&&n.meterIssues.length>0&&n.meterIssues.forEach(c=>{const d=document.createElement("div");d.className="issue",d.textContent=c,s.appendChild(d)}),r.appendChild(s);const i=document.createElement("div");i.className=`summary-item ${n.rhymeSchemeValid?"valid":"invalid"}`,i.innerHTML=`<strong>Rhyme Scheme:</strong> ${n.rhymeSchemeValid?"✓ Valid":"✗ Issues Found"}`,!n.rhymeSchemeValid&&n.rhymeIssues.length>0&&n.rhymeIssues.forEach(c=>{const d=document.createElement("div");d.className="issue",d.textContent=c,i.appendChild(d)}),r.appendChild(i),f.appendChild(r)}j.addEventListener("click",()=>{const n=M.value.trim();if(!n){alert("Please enter a sonnet to analyze.");return}if(!w){alert("Dictionary is still loading. Please wait a moment and try again.");return}if(!p){alert("Please select a poetic form.");return}try{const e=O.analyzeSonnet(n,p);Z(e)}catch(e){console.error("Analysis error:",e),f.innerHTML=`<p style="color: red;">Error analyzing sonnet: ${e}</p>`}});const Q=`Shall I compare thee to a summer's day
Thou art more lovely and more temperate
Rough winds do shake the darling buds of May
And summer's lease hath all too short a date
Sometime too hot the eye of heaven shines
And often is his gold complexion dimmed
And every fair from fair sometime declines
By chance or nature's changing course untrimmed
But thy eternal summer shall not fade
Nor lose possession of that fair thou owest
Nor shall death brag thou wanderest in his shade
When in eternal lines to time thou grow
So long as men can breathe or eyes can see
So long lives this and this gives life to thee`;M.value=Q;console.log("Sonnet Checker loaded successfully!");
//# sourceMappingURL=index-Cvr74ODK.js.map
